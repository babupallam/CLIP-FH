======= Stage 2b: Fine-tune Image Encoder (Debug Mode) =======
Experiment Name  : stage2b_finetune_vitb16_11k_dorsal_r
Model & Dataset  : vitb16, 11k, dorsal_r
Freeze Text Enc. : True
Freeze Prompt    : True
Loss Weights     : Triplet=1.0, i2t=1.0
Save Path        : saved_models/stage2b_finetune_vitb16_11k_dorsal_r_vitb16_11k_dorsal_r_e30_lr1e-04_bs32_ctx8_freezeTTrue_freezePTrue_from2a_lossT1.0_I2T1.0.pth
LR=0.0001 | Epochs=30 | BatchSize=32

--- [Epoch 1/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6100 | Tri=0.1443 | i2t=3.4657
[Epoch 1] Total Loss=3.5739 | Tri Loss=0.1156 | i2t Loss=3.4583 | Acc@1=2.70% | Acc@5=10.22% | Acc@10=20.00% | Time=1049.81s | LR=0.000100

--- [Epoch 2/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6549 | Tri=0.1892 | i2t=3.4657
[Epoch 2] Total Loss=3.6894 | Tri Loss=0.2310 | i2t Loss=3.4583 | Acc@1=1.46% | Acc@5=12.13% | Acc@10=18.09% | Time=1056.10s | LR=0.000100

--- [Epoch 3/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7629 | Tri=0.2972 | i2t=3.4657
[Epoch 3] Total Loss=3.7264 | Tri Loss=0.2681 | i2t Loss=3.4583 | Acc@1=2.47% | Acc@5=8.20% | Acc@10=17.30% | Time=1052.22s | LR=0.000100

--- [Epoch 4/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6301 | Tri=0.1643 | i2t=3.4657
[Epoch 4] Total Loss=3.7367 | Tri Loss=0.2783 | i2t Loss=3.4583 | Acc@1=0.56% | Acc@5=11.12% | Acc@10=20.45% | Time=1030.11s | LR=0.000100

--- [Epoch 5/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7528 | Tri=0.2870 | i2t=3.4657
[Epoch 5] Total Loss=3.7317 | Tri Loss=0.2733 | i2t Loss=3.4583 | Acc@1=1.12% | Acc@5=8.43% | Acc@10=18.65% | Time=998.59s | LR=0.000100

--- [Epoch 6/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7614 | Tri=0.2957 | i2t=3.4657
[Epoch 6] Total Loss=3.7160 | Tri Loss=0.2576 | i2t Loss=3.4583 | Acc@1=2.58% | Acc@5=9.33% | Acc@10=17.08% | Time=987.92s | LR=0.000100

--- [Epoch 7/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7533 | Tri=0.2876 | i2t=3.4657
[Epoch 7] Total Loss=3.6863 | Tri Loss=0.2280 | i2t Loss=3.4583 | Acc@1=2.02% | Acc@5=11.12% | Acc@10=25.84% | Time=977.46s | LR=0.000100

--- [Epoch 8/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6324 | Tri=0.1667 | i2t=3.4657
[Epoch 8] Total Loss=3.5847 | Tri Loss=0.1264 | i2t Loss=3.4583 | Acc@1=2.92% | Acc@5=9.78% | Acc@10=19.89% | Time=990.30s | LR=0.000100

--- [Epoch 9/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.4755 | Tri=0.0098 | i2t=3.4657
[Epoch 9] Total Loss=3.6606 | Tri Loss=0.2023 | i2t Loss=3.4583 | Acc@1=2.47% | Acc@5=13.60% | Acc@10=18.99% | Time=1000.44s | LR=0.000100

--- [Epoch 10/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7134 | Tri=0.2477 | i2t=3.4657
[Epoch 10] Total Loss=3.6247 | Tri Loss=0.1664 | i2t Loss=3.4583 | Acc@1=3.60% | Acc@5=12.47% | Acc@10=20.45% | Time=1006.95s | LR=0.000100

--- [Epoch 11/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.5344 | Tri=0.0687 | i2t=3.4657
[Epoch 11] Total Loss=3.6986 | Tri Loss=0.2403 | i2t Loss=3.4583 | Acc@1=4.72% | Acc@5=14.16% | Acc@10=21.80% | Time=1013.67s | LR=0.000100

--- [Epoch 12/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7355 | Tri=0.2697 | i2t=3.4657
[Epoch 12] Total Loss=3.6358 | Tri Loss=0.1775 | i2t Loss=3.4583 | Acc@1=2.81% | Acc@5=11.01% | Acc@10=21.57% | Time=1012.23s | LR=0.000100

--- [Epoch 13/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.5944 | Tri=0.1287 | i2t=3.4657
[Epoch 13] Total Loss=3.5664 | Tri Loss=0.1080 | i2t Loss=3.4583 | Acc@1=0.90% | Acc@5=8.09% | Acc@10=17.75% | Time=1017.69s | LR=0.000100

--- [Epoch 14/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.4966 | Tri=0.0309 | i2t=3.4657
[Epoch 14] Total Loss=3.5412 | Tri Loss=0.0829 | i2t Loss=3.4583 | Acc@1=1.80% | Acc@5=7.87% | Acc@10=19.89% | Time=1089.15s | LR=0.000100

--- [Epoch 15/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.4910 | Tri=0.0253 | i2t=3.4657
[Epoch 15] Total Loss=3.5263 | Tri Loss=0.0679 | i2t Loss=3.4583 | Acc@1=1.12% | Acc@5=8.88% | Acc@10=16.52% | Time=1032.87s | LR=0.000100

--- [Epoch 16/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7050 | Tri=0.2393 | i2t=3.4657
[Epoch 16] Total Loss=3.5500 | Tri Loss=0.0917 | i2t Loss=3.4583 | Acc@1=2.25% | Acc@5=7.98% | Acc@10=15.51% | Time=989.84s | LR=0.000100

--- [Epoch 17/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.4657 | Tri=0.0000 | i2t=3.4657
[Epoch 17] Total Loss=3.5682 | Tri Loss=0.1099 | i2t Loss=3.4583 | Acc@1=2.47% | Acc@5=15.17% | Acc@10=24.16% | Time=990.98s | LR=0.000100

--- [Epoch 18/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6674 | Tri=0.2017 | i2t=3.4657
[Epoch 18] Total Loss=3.6186 | Tri Loss=0.1602 | i2t Loss=3.4583 | Acc@1=1.57% | Acc@5=8.43% | Acc@10=18.20% | Time=993.84s | LR=0.000100

--- [Epoch 19/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7604 | Tri=0.2947 | i2t=3.4657
[Epoch 19] Total Loss=3.7294 | Tri Loss=0.2711 | i2t Loss=3.4583 | Acc@1=1.35% | Acc@5=10.90% | Acc@10=18.76% | Time=1014.19s | LR=0.000100

--- [Epoch 20/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.5773 | Tri=0.1116 | i2t=3.4657
[Epoch 20] Total Loss=3.6107 | Tri Loss=0.1524 | i2t Loss=3.4583 | Acc@1=1.46% | Acc@5=13.60% | Acc@10=18.43% | Time=991.76s | LR=0.000100

--- [Epoch 21/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.4793 | Tri=0.0135 | i2t=3.4657
[Epoch 21] Total Loss=3.6107 | Tri Loss=0.1524 | i2t Loss=3.4583 | Acc@1=3.48% | Acc@5=8.31% | Acc@10=17.98% | Time=987.70s | LR=0.000100

--- [Epoch 22/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6159 | Tri=0.1502 | i2t=3.4657
[Epoch 22] Total Loss=3.5924 | Tri Loss=0.1341 | i2t Loss=3.4583 | Acc@1=2.25% | Acc@5=8.88% | Acc@10=18.20% | Time=1086.74s | LR=0.000100

--- [Epoch 23/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.4997 | Tri=0.0339 | i2t=3.4657
[Epoch 23] Total Loss=3.5389 | Tri Loss=0.0806 | i2t Loss=3.4583 | Acc@1=3.82% | Acc@5=9.33% | Acc@10=17.87% | Time=1151.61s | LR=0.000100

--- [Epoch 24/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.5956 | Tri=0.1299 | i2t=3.4657
[Epoch 24] Total Loss=3.5544 | Tri Loss=0.0961 | i2t Loss=3.4583 | Acc@1=1.57% | Acc@5=13.26% | Acc@10=23.26% | Time=1176.10s | LR=0.000100

--- [Epoch 25/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.5201 | Tri=0.0543 | i2t=3.4657
[Epoch 25] Total Loss=3.5441 | Tri Loss=0.0858 | i2t Loss=3.4583 | Acc@1=3.15% | Acc@5=10.11% | Acc@10=17.19% | Time=1117.28s | LR=0.000100

--- [Epoch 26/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.5334 | Tri=0.0677 | i2t=3.4657
[Epoch 26] Total Loss=3.5919 | Tri Loss=0.1335 | i2t Loss=3.4583 | Acc@1=1.12% | Acc@5=6.29% | Acc@10=16.97% | Time=1143.73s | LR=0.000100

--- [Epoch 27/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.6925 | Tri=0.2267 | i2t=3.4657
[Epoch 27] Total Loss=3.7153 | Tri Loss=0.2570 | i2t Loss=3.4583 | Acc@1=4.04% | Acc@5=12.13% | Acc@10=20.67% | Time=1085.33s | LR=0.000100

--- [Epoch 28/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7411 | Tri=0.2754 | i2t=3.4657
[Epoch 28] Total Loss=3.7233 | Tri Loss=0.2650 | i2t Loss=3.4583 | Acc@1=3.48% | Acc@5=11.57% | Acc@10=18.65% | Time=1044.28s | LR=0.000100

--- [Epoch 29/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7641 | Tri=0.2984 | i2t=3.4657
[Epoch 29] Total Loss=3.7524 | Tri Loss=0.2941 | i2t Loss=3.4583 | Acc@1=3.15% | Acc@5=13.37% | Acc@10=25.84% | Time=1095.83s | LR=0.000100

--- [Epoch 30/30] ---
[DEBUG] Batch 0 - image shape: torch.Size([32, 3, 224, 224]), labels shape: torch.Size([32])
[DEBUG] image_features shape: torch.Size([32, 512])
[DEBUG] text_features shape: torch.Size([32, 512])
[DEBUG] Step 0: Loss=3.7632 | Tri=0.2975 | i2t=3.4657
[Epoch 30] Total Loss=3.7274 | Tri Loss=0.2691 | i2t Loss=3.4583 | Acc@1=1.35% | Acc@5=11.91% | Acc@10=17.19% | Time=1076.36s | LR=0.000100
[DEBUG] Training complete. Image encoder saved to: saved_models/stage2b_finetune_vitb16_11k_dorsal_r_vitb16_11k_dorsal_r_e30_lr1e-04_bs32_ctx8_freezeTTrue_freezePTrue_from2a_lossT1.0_I2T1.0.pth

====== FINAL TRAINING SUMMARY ======
Total epochs trained : 30
Avg Loss            : 3.6375
Avg Triplet Loss    : 0.1792
Avg i2t Loss        : 3.4583
Avg Acc@1           : 2.33%
Avg Acc@5           : 10.59%
Avg Acc@10          : 19.44%
Best Epoch (Acc@1)  : 11
=====================================
